<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一篇就够了：前端全流程性能优化 | 潜心摸鱼，戒骄戒躁</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="....">
    <link rel="preload" href="/assets/css/0.styles.8ada974c.css" as="style"><link rel="preload" href="/assets/js/app.be40bd60.js" as="script"><link rel="preload" href="/assets/js/2.fcfb7384.js" as="script"><link rel="preload" href="/assets/js/10.a9ac570e.js" as="script"><link rel="prefetch" href="/assets/js/11.416a0fa6.js"><link rel="prefetch" href="/assets/js/12.0b6b2e75.js"><link rel="prefetch" href="/assets/js/3.c76c3f2c.js"><link rel="prefetch" href="/assets/js/4.b6579f35.js"><link rel="prefetch" href="/assets/js/5.b086611e.js"><link rel="prefetch" href="/assets/js/6.9ea11631.js"><link rel="prefetch" href="/assets/js/7.296733e2.js"><link rel="prefetch" href="/assets/js/8.d1df2860.js"><link rel="prefetch" href="/assets/js/9.89661334.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8ada974c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">潜心摸鱼，戒骄戒躁</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识体系" class="dropdown-title"><span class="title">前端知识体系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/articles/react.html" class="nav-link">
  一篇就够了：React全家桶
</a></li><li class="dropdown-item"><!----> <a href="/articles/network.html" class="nav-link">
  一篇就够了：Http基础知识一网打尽
</a></li><li class="dropdown-item"><!----> <a href="/articles/optimize.html" class="nav-link router-link-exact-active router-link-active">
  一篇就够了：前端性能优化
</a></li><li class="dropdown-item"><!----> <a href="/articles/css.html" class="nav-link">
  必知必会：CSS
</a></li><li class="dropdown-item"><!----> <a href="/articles/es6.html" class="nav-link">
  必知必会：JavaScript与ES6
</a></li><li class="dropdown-item"><!----> <a href="/articles/node.html" class="nav-link">
  必知必会：Node.js
</a></li><li class="dropdown-item"><!----> <a href="/articles/design-patterns.html" class="nav-link">
  必知必会：设计模式
</a></li><li class="dropdown-item"><!----> <a href="/articles/security.html" class="nav-link">
  必知必会：Web安全
</a></li><li class="dropdown-item"><!----> <a href="/articles/algorithm.html" class="nav-link">
  必知必会：算法
</a></li><li class="dropdown-item"><!----> <a href="/articles/engineer.html" class="nav-link">
  必知必会：工程化与部署
</a></li><li class="dropdown-item"><!----> <a href="/articles/multi-terminal.html" class="nav-link">
  快速上手：多端（Taro）
</a></li><li class="dropdown-item"><!----> <a href="/articles/webpack-v5.html" class="nav-link">
  快速上手：Webpack 5.0
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手写题" class="dropdown-title"><span class="title">手写题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/articles/debounce-throttle.html" class="nav-link">
  防抖、节流
</a></li><li class="dropdown-item"><!----> <a href="/articles/copy.html" class="nav-link">
  深浅拷贝
</a></li><li class="dropdown-item"><!----> <a href="/articles/entrust.html" class="nav-link">
  事件委托
</a></li><li class="dropdown-item"><!----> <a href="/articles/new.html" class="nav-link">
  new
</a></li><li class="dropdown-item"><!----> <a href="/articles/promise.html" class="nav-link">
  promise
</a></li><li class="dropdown-item"><!----> <a href="/articles/call-apply-bind.html" class="nav-link">
  call、apply、bind
</a></li><li class="dropdown-item"><!----> <a href="/articles/curry.html" class="nav-link">
  函数柯里化
</a></li><li class="dropdown-item"><!----> <a href="/articles/drag-dom.html" class="nav-link">
  实现拖拽div
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="有趣的小项目" class="dropdown-title"><span class="title">有趣的小项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/articles/little-news.html" class="nav-link">
  Chrome插件：前端小报
</a></li><li class="dropdown-item"><!----> <a href="/articles/green-wall.html" class="nav-link">
  VSCode插件：用Github小绿点画个画
</a></li><li class="dropdown-item"><!----> <a href="/articles/ftp-deploy.html" class="nav-link">
  Webpack Plugin：ftpDeploy
</a></li><li class="dropdown-item"><!----> <a href="/articles/multi-language.html" class="nav-link">
  Webpack Loader：多语言
</a></li><li class="dropdown-item"><!----> <a href="/articles/apm.html" class="nav-link">
  前端性能监控系统搭建
</a></li><li class="dropdown-item"><!----> <a href="/articles/code-rule.html" class="nav-link">
  团队开发：代码规范
</a></li><li class="dropdown-item"><!----> <a href="/articles/cli.html" class="nav-link">
  团队开发：React项目脚手架
</a></li><li class="dropdown-item"><!----> <a href="/articles/component.html" class="nav-link">
  团队开发：React项目组件库
</a></li><li class="dropdown-item"><!----> <a href="/articles/component.html" class="nav-link">
  团队开发：项目模板
</a></li></ul></div></div> <a href="https://github.com/Xumengxiang/inner-peace" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识体系" class="dropdown-title"><span class="title">前端知识体系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/articles/react.html" class="nav-link">
  一篇就够了：React全家桶
</a></li><li class="dropdown-item"><!----> <a href="/articles/network.html" class="nav-link">
  一篇就够了：Http基础知识一网打尽
</a></li><li class="dropdown-item"><!----> <a href="/articles/optimize.html" class="nav-link router-link-exact-active router-link-active">
  一篇就够了：前端性能优化
</a></li><li class="dropdown-item"><!----> <a href="/articles/css.html" class="nav-link">
  必知必会：CSS
</a></li><li class="dropdown-item"><!----> <a href="/articles/es6.html" class="nav-link">
  必知必会：JavaScript与ES6
</a></li><li class="dropdown-item"><!----> <a href="/articles/node.html" class="nav-link">
  必知必会：Node.js
</a></li><li class="dropdown-item"><!----> <a href="/articles/design-patterns.html" class="nav-link">
  必知必会：设计模式
</a></li><li class="dropdown-item"><!----> <a href="/articles/security.html" class="nav-link">
  必知必会：Web安全
</a></li><li class="dropdown-item"><!----> <a href="/articles/algorithm.html" class="nav-link">
  必知必会：算法
</a></li><li class="dropdown-item"><!----> <a href="/articles/engineer.html" class="nav-link">
  必知必会：工程化与部署
</a></li><li class="dropdown-item"><!----> <a href="/articles/multi-terminal.html" class="nav-link">
  快速上手：多端（Taro）
</a></li><li class="dropdown-item"><!----> <a href="/articles/webpack-v5.html" class="nav-link">
  快速上手：Webpack 5.0
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="手写题" class="dropdown-title"><span class="title">手写题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/articles/debounce-throttle.html" class="nav-link">
  防抖、节流
</a></li><li class="dropdown-item"><!----> <a href="/articles/copy.html" class="nav-link">
  深浅拷贝
</a></li><li class="dropdown-item"><!----> <a href="/articles/entrust.html" class="nav-link">
  事件委托
</a></li><li class="dropdown-item"><!----> <a href="/articles/new.html" class="nav-link">
  new
</a></li><li class="dropdown-item"><!----> <a href="/articles/promise.html" class="nav-link">
  promise
</a></li><li class="dropdown-item"><!----> <a href="/articles/call-apply-bind.html" class="nav-link">
  call、apply、bind
</a></li><li class="dropdown-item"><!----> <a href="/articles/curry.html" class="nav-link">
  函数柯里化
</a></li><li class="dropdown-item"><!----> <a href="/articles/drag-dom.html" class="nav-link">
  实现拖拽div
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="有趣的小项目" class="dropdown-title"><span class="title">有趣的小项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/articles/little-news.html" class="nav-link">
  Chrome插件：前端小报
</a></li><li class="dropdown-item"><!----> <a href="/articles/green-wall.html" class="nav-link">
  VSCode插件：用Github小绿点画个画
</a></li><li class="dropdown-item"><!----> <a href="/articles/ftp-deploy.html" class="nav-link">
  Webpack Plugin：ftpDeploy
</a></li><li class="dropdown-item"><!----> <a href="/articles/multi-language.html" class="nav-link">
  Webpack Loader：多语言
</a></li><li class="dropdown-item"><!----> <a href="/articles/apm.html" class="nav-link">
  前端性能监控系统搭建
</a></li><li class="dropdown-item"><!----> <a href="/articles/code-rule.html" class="nav-link">
  团队开发：代码规范
</a></li><li class="dropdown-item"><!----> <a href="/articles/cli.html" class="nav-link">
  团队开发：React项目脚手架
</a></li><li class="dropdown-item"><!----> <a href="/articles/component.html" class="nav-link">
  团队开发：React项目组件库
</a></li><li class="dropdown-item"><!----> <a href="/articles/component.html" class="nav-link">
  团队开发：项目模板
</a></li></ul></div></div> <a href="https://github.com/Xumengxiang/inner-peace" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/optimize.html" class="active sidebar-link">一篇就够了：前端性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/optimize.html#性能监控" class="sidebar-link">性能监控</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/optimize.html#性能指标" class="sidebar-link">性能指标</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#lighthouse" class="sidebar-link">Lighthouse</a></li></ul></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#nginx" class="sidebar-link">Nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/optimize.html#开启-gzip-压缩" class="sidebar-link">开启 GZIP 压缩</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#开启-http-2-0" class="sidebar-link">开启 HTTP 2.0</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#静态资源缓存" class="sidebar-link">静态资源缓存</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#负载均衡" class="sidebar-link">负载均衡</a></li></ul></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#webpack" class="sidebar-link">Webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/optimize.html#代码分割" class="sidebar-link">代码分割</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#uglifyjs-压缩" class="sidebar-link">UglifyJs 压缩</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#cdn" class="sidebar-link">CDN</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#tree-shaking" class="sidebar-link">Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#gzip" class="sidebar-link">GZIP</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#webpack-bundle-analyze" class="sidebar-link">webpack-bundle-analyze</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#提取公共依赖" class="sidebar-link">提取公共依赖</a></li></ul></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#按需加载" class="sidebar-link">按需加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/optimize.html#组件懒加载" class="sidebar-link">组件懒加载</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#组件预加载" class="sidebar-link">组件预加载</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#模块按需引入" class="sidebar-link">模块按需引入</a></li></ul></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#其它" class="sidebar-link">其它</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/optimize.html#预加载-preload-prefetch" class="sidebar-link">预加载 Preload/Prefetch</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#defer-和-async" class="sidebar-link">defer 和 async</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#ssr-和-pre-render" class="sidebar-link">SSR 和 Pre-render</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#节流、防抖" class="sidebar-link">节流、防抖</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#事件委托" class="sidebar-link">事件委托</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#css-相关性能优化" class="sidebar-link">CSS 相关性能优化</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#虚拟列表" class="sidebar-link">虚拟列表</a></li><li class="sidebar-sub-header"><a href="/articles/optimize.html#web-worker" class="sidebar-link">Web Worker</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="一篇就够了：前端全流程性能优化"><a href="#一篇就够了：前端全流程性能优化" class="header-anchor">#</a> 一篇就够了：前端全流程性能优化</h1> <p><img src="/optimize.jpg" alt="一篇就够了：前端全流程性能优化"></p> <h2 id="性能监控"><a href="#性能监控" class="header-anchor">#</a> 性能监控</h2> <p>一个页面性能差的话会大大影响用户体验。用户打开页面等待的太久，可能会直接关掉页面，甚至就不再使用了，这种情况在移动端更加明显，移动端用户对页面响应延迟容忍度很低。虽然页面性能很重要，但是在实际使用中，页面性能差的情况并不少见。主要有以下两个原因：</p> <ul><li>在产品的迭代演进过程中，页面性能可能会被忽略，性能随着<strong>版本迭代</strong>而有所衰减</li> <li>性能优化是一项复杂而挑战的事情，需要明确的优化方向和具体的优化手段才能快速落地取效</li></ul> <p>所以需要一个性能监控系统，持续监控和预警页面性能的状况，并且在发现瓶颈的时候指导优化工作。</p> <h3 id="性能指标"><a href="#性能指标" class="header-anchor">#</a> 性能指标</h3> <h4 id="首次内容绘制（fcp）-白屏"><a href="#首次内容绘制（fcp）-白屏" class="header-anchor">#</a> 首次内容绘制（FCP）- 白屏</h4> <p>不管是我们如何优化性能，首屏必然是会出现白屏的，因为这是前端开发这项技术的特点决定的。从路由改变起(即用户再按下回车的瞬间)到首次内容绘制(即能看到第一个内容)为止算白屏时间。</p> <p>白屏时间内发生了什么：</p> <ol><li>回车按下，浏览器解析网址，进行 <code>DNS</code> 查询，查询返回 <code>IP</code>，通过 <code>IP</code> 发出 <code>HTTP(S)</code> 请求</li> <li>服务器返回<code>HTML</code>，浏览器开始解析 <code>HTML</code>，此时触发请求 <code>js</code> 和 <code>css</code> 资源</li> <li><code>js</code> 被加载，开始执行 <code>js</code>，调用各种函数创建 <code>DOM</code> 并渲染到根节点，直到第一个可见元素产生</li></ol> <h5 id="对应的优化措施"><a href="#对应的优化措施" class="header-anchor">#</a> 对应的优化措施</h5> <ul><li>Loading 提示</li> <li>(伪)服务端渲染</li> <li>开启HTTP2</li> <li>开启浏览器缓存</li></ul> <h4 id="首次有意义绘制（fmp）"><a href="#首次有意义绘制（fmp）" class="header-anchor">#</a> 首次有意义绘制（FMP）</h4> <p>在白屏结束之后，页面开始渲染，但是此时的页面还只是出现个别无意义的元素，比如下拉菜单按钮、或者乱序的元素、导航等等，这些元素虽然是页面的组成部分但是没有意义。只有可是区域内元素渲染完成才算是有意义绘制。</p> <h5 id="对应的优化措施-2"><a href="#对应的优化措施-2" class="header-anchor">#</a> 对应的优化措施</h5> <ul><li><code>Skeleton</code>骨架屏</li></ul> <h4 id="可交互时间（tti）"><a href="#可交互时间（tti）" class="header-anchor">#</a> 可交互时间（TTI）</h4> <p>当有意义的内容渲染出来之后，用户会尝试与页面交互，这个时候页面并不是加载完毕了，而是看起来页面加载完毕了，事实上这个时候 JavaScript 脚本依然在密集得执行。</p> <p>这个时候页面并不是可交互的，直到<code>TTI</code> 的到来，<code>TTI</code>到来之后用户就可以跟页面进行正常交互的，<code>TTI</code>一般没有特别精确的测量方法，普遍认为满足 <strong><code>FMP</code> &amp;&amp; <code>DOMContentLoader</code>事件触发 &amp;&amp; 页面视觉加载85%</strong> 这几个条件后，<code>TTI</code> 就算是到来了。</p> <h5 id="对应的优化措施-3"><a href="#对应的优化措施-3" class="header-anchor">#</a> 对应的优化措施</h5> <ul><li><code>Tree Shaking</code></li> <li><code>polyfill</code>动态加载</li> <li>动态加载<code>ES6</code>代码</li> <li>路由级别拆解代码</li></ul> <h3 id="lighthouse"><a href="#lighthouse" class="header-anchor">#</a> Lighthouse</h3> <p>Lighthouse 是一个开源的自动化工具，用于改进网络应用的质量。 你可以在 Chrome DevTools 面板中找到 Lighthouse。</p> <p>运行Lighthouse会给页面打分并给出优化建议。</p> <h4 id="运行参数选择界面"><a href="#运行参数选择界面" class="header-anchor">#</a> 运行参数选择界面</h4> <p><img src="/lighthouse1.png" alt="启动Lighthouse"></p> <h4 id="运行结果界面"><a href="#运行结果界面" class="header-anchor">#</a> 运行结果界面</h4> <p><img src="/lighthouse2.png" alt="Lighthouse运行结果"></p> <h2 id="nginx"><a href="#nginx" class="header-anchor">#</a> Nginx</h2> <h3 id="开启-gzip-压缩"><a href="#开启-gzip-压缩" class="header-anchor">#</a> 开启 GZIP 压缩</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 开启gzip</span>
<span class="token keyword">gzip</span> on<span class="token punctuation">;</span>

<span class="token comment"># 启用gzip压缩的最小文件；小于设置值的文件将不会被压缩</span>
<span class="token keyword">gzip_min_length</span> <span class="token number">1</span>k<span class="token punctuation">;</span>

<span class="token comment"># gzip 压缩级别 1-10</span>
<span class="token keyword">gzip_comp_level</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment"># 进行压缩的文件类型。</span>

<span class="token keyword">gzip_types</span> text<span class="token operator">/</span>plain application<span class="token operator">/</span>javascript application<span class="token operator">/</span>x<span class="token operator">-</span>javascript text<span class="token operator">/</span>css application<span class="token operator">/</span>xml text<span class="token operator">/</span>javascript application<span class="token operator">/</span>x<span class="token operator">-</span>httpd<span class="token operator">-</span>php image<span class="token operator">/</span>jpeg image<span class="token operator">/</span>gif image<span class="token operator">/</span>png<span class="token punctuation">;</span>

<span class="token comment"># 是否在http header中添加Vary: Accept-Encoding，建议开启</span>
<span class="token keyword">gzip_vary</span> on<span class="token punctuation">;</span>
</code></pre></div><h3 id="开启-http-2-0"><a href="#开启-http-2-0" class="header-anchor">#</a> 开启 HTTP 2.0</h3> <p>注意事项：</p> <ul><li><code>Nginx</code> <code>1.10.0</code> 以上版本才支持 <code>Http2.0</code>，如果使用的是 <code>Tengine</code>，版本需要大于 <code>2.2.1</code></li> <li><code>Http2.0</code> 只支持 <code>Https</code> 协议的网站，且 <code>openssl</code> 版本需要高于 <code>1.0.2</code></li></ul> <p>在保证以上两点的情况下，<code>Nginx</code> 配置 <code>http2</code> 很简单，只需要在 <code>listen</code> 的端口后新增 <code>http2</code> 标识即可，如下：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span>  <span class="token number">443</span> <span class="token keyword">ssl</span> http2<span class="token punctuation">;</span>
  <span class="token keyword">server_name</span>  hostname<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

  <span class="token keyword">ssl_certificate</span>   cert<span class="token operator">/</span><span class="token number">214547145790616.</span>pem<span class="token punctuation">;</span>
  <span class="token keyword">ssl_certificate_key</span>  cert<span class="token operator">/</span><span class="token number">214547145790616.</span>key<span class="token punctuation">;</span>

  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8088</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="静态资源缓存"><a href="#静态资源缓存" class="header-anchor">#</a> 静态资源缓存</h3> <p>有些静态资源更新频率低或者不更新，我们可以通过设置expires来配置缓存时间，以此来达到优化性能作用，那怎么配置呢？</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">~</span> \<span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
  <span class="token keyword">root</span> <span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>
  <span class="token keyword">expires</span> <span class="token number">7</span>d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h3> <p>负载均衡器可以通过分配其他的服务器给用户，来增加的网站的稳定性和响应速度，而且负载均衡器有四种常用方式，这里要提的是响应时间来分配的模式，可以让多台服务器竞争，找出相应最快的并返回内容给用户，配置如下:</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">upstream</span> backserver <span class="token punctuation">{</span>
  <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">;</span>
  <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.2</span><span class="token punctuation">;</span>
  <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.3</span><span class="token punctuation">;</span>
  fair<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span> loacalhost<span class="token punctuation">;</span>
  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>backserver<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h2> <h3 id="代码分割"><a href="#代码分割" class="header-anchor">#</a> 代码分割</h3> <p>代码分割主要有以下三种方式：</p> <h4 id="entry-points"><a href="#entry-points" class="header-anchor">#</a> Entry Points</h4> <p>配置多个入口</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    another<span class="token operator">:</span> <span class="token string">'./src/another.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>直接设置<code>entry</code>来分隔代码有一些缺陷：</p> <ul><li>如果两个<code>entry</code>中都引用了相同的<code>module</code>，那么最终生成的两个文件中都会包含相同的内容。</li> <li>不能根据代码中实际的代码逻辑来动态的分割代码。</li></ul> <p>针对上面重复引用的问题，解决方案如下：</p> <ul><li><code>dependOn</code> 选项</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');

module.exports = {
<span class="token unchanged">  entry: {
</span><span class="token deleted-sign deleted">-   index: './src/index.js',
-   another: './src/another.js',
</span><span class="token inserted-sign inserted">+   index: { import: './src/index.js', dependOn: 'shared' },
+   another: { import: './src/another.js', dependOn: 'shared' },
+   shared: 'lodash',
</span><span class="token unchanged">  },
  output: {
    filename: '[name].bundle.js',
    path: path.resolve(__dirname, 'dist'),
  },
</span>}
</code></pre></div><h4 id="使用split-chunk-plugin"><a href="#使用split-chunk-plugin" class="header-anchor">#</a> 使用<code>split-chunk-plugin</code></h4> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');

module.exports = {
<span class="token unchanged">  entry: {
    index: './src/index.js',
    another: './src/another.js',
  },
  output: {
    filename: '[name].bundle.js',
    path: path.resolve(__dirname, 'dist'),
  },
</span><span class="token inserted-sign inserted">+ optimization: {
+   splitChunks: {
+     chunks: 'all',
+   },
+ },
</span>}
</code></pre></div><h4 id="动态引入"><a href="#动态引入" class="header-anchor">#</a> 动态引入</h4> <p>使用动态引入语法，<code>require.ensuse（legacy）</code>、<code>import()</code></p> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');

module.exports = {
<span class="token unchanged">  entry: {
    index: './src/index.js',
</span><span class="token deleted-sign deleted">-   another: './src/another.js',
</span><span class="token unchanged">  },
  output: {
    filename: '[name].bundle.js',
</span><span class="token inserted-sign inserted">+   chunkFilename: '[name].bundle.js',
</span><span class="token unchanged">    publicPath: 'dist/',
    path: path.resolve(__dirname, 'dist'),
  },
</span><span class="token deleted-sign deleted">- optimization: {
-   splitChunks: {
-     chunks: 'all',
-   },
- },
</span>}
</code></pre></div><p>通过<code>import().then()</code>引入组件</p> <div class="language-js extra-class"><pre class="language-js"><code>funtion <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token keyword">default</span><span class="token operator">:</span> _ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'Webpack'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> element<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token string">'Error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">component</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="uglifyjs-压缩"><a href="#uglifyjs-压缩" class="header-anchor">#</a> UglifyJs 压缩</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> UglifyJsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uglifyjs-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// Uncomment lines below for cache invalidation correctly</span>
        <span class="token comment">// cache: true,</span>
        <span class="token comment">// cacheKeys(defaultCacheKeys) {</span>
        <span class="token comment">//   delete defaultCacheKeys['uglify-js'];</span>
        <span class="token comment">//</span>
        <span class="token comment">//   return Object.assign(</span>
        <span class="token comment">//     {},</span>
        <span class="token comment">//     defaultCacheKeys,</span>
        <span class="token comment">//     { 'uglify-js': require('uglify-js/package.json').version },</span>
        <span class="token comment">//   );</span>
        <span class="token comment">// },</span>
        <span class="token function">minify</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> sourceMap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// https://github.com/mishoo/UglifyJS2#minify-options</span>
          <span class="token keyword">const</span> uglifyJsOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token comment">/* `uglify-js` package 的相关配置 */</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>sourceMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            uglifyJsOptions<span class="token punctuation">.</span>sourceMap <span class="token operator">=</span> <span class="token punctuation">{</span>
              content<span class="token operator">:</span> sourceMap<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minify</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> uglifyJsOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="cdn"><a href="#cdn" class="header-anchor">#</a> CDN</h3> <h4 id="webpack-config-js"><a href="#webpack-config-js" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.jpg$/</span><span class="token punctuation">,</span> loader<span class="token operator">:</span> <span class="token string">'file-loader'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.png$/</span><span class="token punctuation">,</span> loader<span class="token operator">:</span> <span class="token string">'url-loader'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    publicPath<span class="token operator">:</span> <span class="token string">'http://cdn.example.com/[hash]/'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="file-html"><a href="#file-html" class="header-anchor">#</a> file.html</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image2x.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h4 id="index-js"><a href="#index-js" class="header-anchor">#</a> index.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-loader!./file.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// =&gt; '&lt;img src=&quot;http://cdn.example.com/49eba9f/a992ca.jpg&quot; data-src=&quot;image2x.png&quot;&gt;'</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-loader?{&quot;attributes&quot;:{&quot;list&quot;:[{&quot;tag&quot;:&quot;img&quot;,&quot;attribute&quot;:&quot;data-src&quot;,&quot;type&quot;:&quot;src&quot;}]}}!./file.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// =&gt; '&lt;img src=&quot;image.jpg&quot; data-src=&quot;data:image/png;base64,...&quot; &gt;'</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-loader?{&quot;attributes&quot;:{&quot;list&quot;:[{&quot;tag&quot;:&quot;img&quot;,&quot;attribute&quot;:&quot;src&quot;,&quot;type&quot;:&quot;src&quot;},{&quot;tag&quot;:&quot;img&quot;,&quot;attribute&quot;:&quot;data-src&quot;,&quot;type&quot;:&quot;src&quot;}]}}!./file.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// =&gt; '&lt;img src=&quot;http://cdn.example.com/49eba9f/a992ca.jpg&quot; data-src=&quot;data:image/png;base64,...&quot; &gt;'</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-loader?-attributes!./file.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// =&gt; '&lt;img src=&quot;image.jpg&quot;  data-src=&quot;image2x.png&quot; &gt;'</span>
</code></pre></div><h3 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> Tree Shaking</h3> <div class="language-diff extra-class"><pre class="language-diff"><code>const path = require('path');

module.exports = {
<span class="token unchanged">  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
  },
</span><span class="token inserted-sign inserted">+ mode: 'development',
+ optimization: {
+   usedExports: true,
+ },
</span>};
</code></pre></div><h3 id="gzip"><a href="#gzip" class="header-anchor">#</a> GZIP</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> CompressionPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CompressionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="webpack-bundle-analyze"><a href="#webpack-bundle-analyze" class="header-anchor">#</a> webpack-bundle-analyze</h3> <h3 id="提取公共依赖"><a href="#提取公共依赖" class="header-anchor">#</a> 提取公共依赖</h3> <h2 id="按需加载"><a href="#按需加载" class="header-anchor">#</a> 按需加载</h2> <h3 id="组件懒加载"><a href="#组件懒加载" class="header-anchor">#</a> 组件懒加载</h3> <h3 id="组件预加载"><a href="#组件预加载" class="header-anchor">#</a> 组件预加载</h3> <h3 id="模块按需引入"><a href="#模块按需引入" class="header-anchor">#</a> 模块按需引入</h3> <h2 id="其它"><a href="#其它" class="header-anchor">#</a> 其它</h2> <h3 id="预加载-preload-prefetch"><a href="#预加载-preload-prefetch" class="header-anchor">#</a> 预加载 Preload/Prefetch</h3> <h3 id="defer-和-async"><a href="#defer-和-async" class="header-anchor">#</a> defer 和 async</h3> <h3 id="ssr-和-pre-render"><a href="#ssr-和-pre-render" class="header-anchor">#</a> SSR 和 Pre-render</h3> <h3 id="节流、防抖"><a href="#节流、防抖" class="header-anchor">#</a> 节流、防抖</h3> <h3 id="事件委托"><a href="#事件委托" class="header-anchor">#</a> 事件委托</h3> <h3 id="css-相关性能优化"><a href="#css-相关性能优化" class="header-anchor">#</a> CSS 相关性能优化</h3> <h3 id="虚拟列表"><a href="#虚拟列表" class="header-anchor">#</a> 虚拟列表</h3> <h3 id="web-worker"><a href="#web-worker" class="header-anchor">#</a> Web Worker</h3></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后修改时间:</span> <span class="time">9/14/2020, 10:50:10 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.be40bd60.js" defer></script><script src="/assets/js/2.fcfb7384.js" defer></script><script src="/assets/js/10.a9ac570e.js" defer></script>
  </body>
</html>
